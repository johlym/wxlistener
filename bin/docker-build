#!/bin/bash
# Build Docker image for wxlistener

set -e

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

print_section() {
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${BLUE}$1${NC}"
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
}

print_success() {
    echo -e "${GREEN}âœ“ $1${NC}"
}

echo ""
echo -e "${BLUE}ğŸ³ Building wxlistener Docker image${NC}"
echo ""

# Parse arguments
BUILD_TYPE="${1:-production}"

if [ "$BUILD_TYPE" = "dev" ]; then
    print_section "ğŸ“¦ Building development image"
    docker build -f Dockerfile.dev -t wxlistener:dev .
    print_success "Development image built: wxlistener:dev"
else
    print_section "ğŸ“¦ Building production image"
    docker build -t wxlistener:latest .
    print_success "Production image built: wxlistener:latest"
    
    # Show image size
    SIZE=$(docker images wxlistener:latest --format "{{.Size}}")
    echo ""
    echo "Image size: ${BLUE}$SIZE${NC}"
fi

echo ""
print_section "âœ… Build complete!"
echo ""
echo "Run the image:"
echo "  ${BLUE}docker run --rm wxlistener:latest --help${NC}"
echo ""
echo "Or use docker-compose:"
echo "  ${BLUE}docker-compose up${NC}"
echo ""
